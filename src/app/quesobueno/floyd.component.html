<div class="container py-4">
    <h2 class="text-center mb-4">Algoritmo Floyd-Warshall ‚Äî Entrada por Matriz o por Canvas</h2>

    <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link" [class.active]="modo==='matriz'" (click)="modo='matriz'">Matriz</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" [class.active]="modo==='canvas'" (click)="modo='canvas'">Canvas (Graficar)</button>
        </li>
    </ul>

    <!-- ======= MODO MATRIZ (reactivo) ======= -->
    <div *ngIf="modo==='matriz'" class="mt-3">
        <div class="row g-3 align-items-end">
            <div class="col-sm-4">
                <label class="form-label">N√∫mero de nodos:</label>
                <input type="number" [(ngModel)]="numNodos" class="form-control"
                    placeholder="Ingrese cantidad de nodos">
            </div>
            <div class="col-sm-8">
                <button class="btn btn-primary me-2" (click)="generarMatriz()">Generar Matriz vac√≠a</button>
                <button class="btn btn-outline-secondary" (click)="generarDesdeCanvas()">Generar Matriz desde
                    Canvas</button>
            </div>
        </div>

        <!-- matriz editable con ngModel -->
        <div class="mt-4" *ngIf="matriz && matriz.length > 0">
            <h4>Matriz de adyacencia</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th></th>
                        <th *ngFor="let col of nombres; let j = index">
                            <input [(ngModel)]="nombres[j]" class="form-control text-center" maxlength="6"
                                placeholder="Nombre">
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let fila of matriz; let i = index">
                        <th>
                            <input [(ngModel)]="nombres[i]" class="form-control text-center" maxlength="6"
                                placeholder="Nombre">
                        </th>
                        <td *ngFor="let val of fila; let j = index">
                            <input class="form-control text-center" [(ngModel)]="matriz[i][j]" [readonly]="i===j"
                                placeholder="‚àû">
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="mt-3">
            <button class="btn btn-success" (click)="ejecutarFloydDesdeMatriz()">Ejecutar Floyd-Warshall (desde
                Matriz)</button>
        </div>

        <div id="iteracionesContainer" class="mt-3" [innerHTML]="iteracionesHtml"></div>
        <div id="resultadoFinal" class="mt-3" [innerHTML]="resultadoHtml"></div>
    </div>

    <!-- ======= MODO CANVAS ======= -->
    <div *ngIf="modo==='canvas'" class="mt-3">
        <div class="row g-3">
            <div class="col-12">
                <canvas #canvas width="900" height="540"
                    style="border:1px solid #333; background:#f8f8f8; cursor: crosshair; display:block; margin:30px auto 0;"
                    (click)="canvasClick($event)">
                </canvas>
            </div>

            <div class="col-12">
                <div class="card tools-card mt-3">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Herramientas (debajo del canvas)</h5>

                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Fondo:</label>
                                <input type="file" class="form-control" (change)="cargarFondo($event)">
                            </div>
                            <div class="col-md-8 d-flex align-items-end gap-2">
                                <button class="btn btn-danger" (click)="quitarFondo()">üóëÔ∏è Quitar fondo</button>
                                <button class="btn btn-warning" (click)="undo()">‚Ü∂ Deshacer</button>
                                <button class="btn btn-info" (click)="redo()">‚Ü∑ Rehacer</button>
                                <div class="ms-auto small-muted">Clic vac√≠o: crea nodo. Clic en nodo + clic en otro:
                                    crea arista.</div>
                            </div>

                            <div class="col-12">
                                <hr>
                                <div class="d-flex gap-2 flex-wrap">
                                    <button class="btn btn-outline-secondary"
                                        (click)="previsualizarMatrizCanvas()">Previsualizar matriz (desde
                                        grafo)</button>
                                    <button class="btn btn-success" (click)="ejecutarFloydCanvas()">Ejecutar
                                        Floyd-Warshall (desde grafo)</button>
                                    <button class="btn btn-outline-primary" (click)="generarDesdeCanvas()">Exportar al
                                        modo Matriz</button>
                                </div>
                            </div>

                            <div class="col-12">
                                <hr>
                                <div class="d-flex flex-wrap gap-2 align-items-center">
                                    <label class="form-label mb-0">Origen:</label>
                                    <select class="form-select form-select-sm w-auto" [(ngModel)]="origenCanvas">
                                        <option *ngFor="let n of canvasSelectNames; index as i" [value]="i">{{n}}
                                        </option>
                                    </select>
                                    <label class="form-label mb-0">Destino:</label>
                                    <select class="form-select form-select-sm w-auto" [(ngModel)]="destinoCanvas">
                                        <option *ngFor="let n of canvasSelectNames; index as i" [value]="i">{{n}}
                                        </option>
                                    </select>
                                    <button class="btn btn-primary btn-sm" (click)="resaltarRuta()">üîç Resaltar ruta
                                        Floyd</button>
                                    <div class="ms-auto small-muted">Requiere haber ejecutado Floyd (desde matriz o
                                        grafo).</div>
                                </div>
                            </div>

                            <div class="col-12">
                                <div id="previewMatrizDesdeCanvas" class="mt-4" [innerHTML]="previewCanvasHtml"></div>
                                <div id="iteracionesCanvas" class="mt-3" [innerHTML]="iteracionesCanvasHtml"></div>
                                <div id="resultadoCanvas" class="mt-3" [innerHTML]="resultadoCanvasHtml"></div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>